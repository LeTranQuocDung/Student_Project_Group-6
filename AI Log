2.1. E-Commerce Simulation (M√¥ h√¨nh Shopee/Lazada) Th·ª±c th·ªÉ: User, Shop, Product (v·ªõi nhi·ªÅu bi·∫øn th·ªÉ Size/M√†u), Order, Voucher. Th√°ch th·ª©c: X·ª≠ l√Ω gi·ªè h√†ng, t√≠nh to√°n khuy·∫øn m√£i ch·ªìng ch√©o, logic t·ªìn kho bi·∫øn th·ªÉ. Simulator: Gi·∫£ l·∫≠p "Flash Sale" - h√†ng ngh√¨n user c√πng ƒë·∫∑t h√†ng m·ªôt l√∫c, h·ªá th·ªëng ph·∫£i tr·ª´ kho ch√≠nh x√°c. ƒë·ªÅ n√†y,  t·∫°o b·ªô d·ªØ li·ªáu m·∫´u legacy data b·∫±ng script >10000 d√≤ng c·ªë t√¨nh c√†i c·∫Øm l·ªói s√†i format v·∫´n theo ƒë·ªÅ b√†i tr√™n
B·∫°n c·∫ßn 1 b·ªô legacy data cho E-Commerce (Shopee/Lazada), > 10.000 d√≤ng, vi·∫øt b·∫±ng JavaScript, v√† C·ªê T√åNH C√ÄI C·∫ÆM L·ªñI nh∆∞ng v·∫´n b√°m format theo ƒë·ªÅ b√†i (User / Shop / Product / Variant / Order / Voucher).

D∆∞·ªõi ƒë√¢y l√† dataset ‚Äúƒë·ªôc √°c‚Äù ƒë√∫ng ch·∫•t legacy ƒë·ªÉ test h·ªá th·ªëng ch·ªãu l·ªói üòà

üß® M·ª•c ti√™u b·ªô d·ªØ li·ªáu n√†y

Dataset n√†y KH√îNG clean, d√πng ƒë·ªÉ test:

‚ùå Oversell kho (ƒë·∫∑t h√†ng > t·ªìn)

‚ùå Voucher sai lu·∫≠t (stack khi kh√¥ng ƒë∆∞·ª£c)

‚ùå Order tr·ªè variant kh√¥ng t·ªìn t·∫°i

‚ùå Gi√° √¢m / gi√° 0

‚ùå Format date l·∫´n l·ªôn

‚ùå Flag boolean l·ªôn x·ªôn (0/1, Y/N, true/false)

‚ùå User / Shop b·ªã deleted nh∆∞ng v·∫´n order

‚ùå Flash Sale race condition (c√πng timestamp)

üëâ R·∫•t ph√π h·ª£p cho:

migrate legacy ‚Üí system m·ªõi

validate data

test transaction & locking

interview system design üòè

üìÅ Output (‚âà 70.000+ d√≤ng JSON)
legacy-users.json
legacy-shops.json
legacy-products.json
legacy-variants.json
legacy-vouchers.json
legacy-orders.json

üìú SCRIPT: generate-broken-legacy-ecommerce.js
const fs = require("fs");

/* ================= CONFIG ================= */
const USERS = 12000;
const SHOPS = 800;
const PRODUCTS = 3000;
const VARIANTS_PER_PRODUCT = 4;
const ORDERS = 20000;

/* ================= UTILS ================= */
const rand = (min, max) =>
  Math.floor(Math.random() * (max - min + 1)) + min;

const pick = (arr) => arr[rand(0, arr.length - 1)];

const legacyDate = () => {
  const formats = [
    () => `${rand(1,28)}/${rand(1,12)}/2023`,
    () => `2023-${rand(1,12)}-${rand(1,28)}`,
    () => `${rand(1,28)}-${rand(1,12)}-23`,
    () => "INVALID_DATE"
  ];
  return pick(formats)();
};

/* ================= USERS ================= */
const users = [];
for (let i = 1; i <= USERS; i++) {
  users.push({
    user_id: i,
    username: `user_${i}`,
    phone: i % 50 === 0 ? null : `09${rand(10000000, 99999999)}`,
    is_active: pick([0, 1, "Y", "N"]),
    deleted_flag: i % 120 === 0 ? "Y" : "N",
    created_at: legacyDate()
  });
}

/* ================= SHOPS ================= */
const shops = [];
for (let i = 1; i <= SHOPS; i++) {
  shops.push({
    shop_id: i,
    shop_name: `SHOP_${i}`,
    owner_user_id: rand(1, USERS),
    rating_avg: i % 40 === 0 ? 7.8 : (Math.random() * 5).toFixed(2), // rating > 5
    is_official: pick([0, 1, "true", "false"]),
    created_at: legacyDate()
  });
}

/* ================= PRODUCTS ================= */
const products = [];
for (let i = 1; i <= PRODUCTS; i++) {
  products.push({
    product_id: i,
    shop_id: rand(1, SHOPS),
    product_name: `PRODUCT_${i}`,
    base_price:
      i % 55 === 0 ? -1000 : rand(10000, 500000), // price √¢m
    is_flash_sale: pick([0, 1, "Y", "N"]),
    created_at: legacyDate()
  });
}

/* ================= VARIANTS ================= */
const variants = [];
let variantId = 1;

products.forEach((p) => {
  for (let i = 0; i < VARIANTS_PER_PRODUCT; i++) {
    variants.push({
      variant_id: variantId++,
      product_id:
        variantId % 97 === 0 ? 999999 : p.product_id, // product kh√¥ng t·ªìn t·∫°i
      size: pick(["S", "M", "L", null]),
      color: pick(["RED", "BLUE", "BLACK", "???"]),
      stock_qty:
        variantId % 45 === 0 ? -5 : rand(0, 100), // kho √¢m
      price_override:
        variantId % 60 === 0 ? 0 : rand(8000, 450000),
      legacy_stock_flag: pick([0, 1, "Y", "N"])
    });
  }
});

/* ================= VOUCHERS ================= */
const vouchers = [];
for (let i = 1; i <= 500; i++) {
  vouchers.push({
    voucher_code: `VC_${i}`,
    discount_type: pick(["PERCENT", "FIXED", "UNKNOWN"]),
    discount_value: i % 30 === 0 ? 150 : rand(5, 50), // percent > 100
    min_order_value: rand(0, 300000),
    max_discount: rand(0, 200000),
    is_stackable: pick([0, 1, "Y", "N"]),
    expired_at: legacyDate()
  });
}

/* ================= ORDERS (FLASH SALE CHAOS) ================= */
const orders = [];
for (let i = 1; i <= ORDERS; i++) {
  const product = pick(products);
  const variant = pick(variants);

  orders.push({
    order_id: i,
    user_id:
      i % 88 === 0 ? 999999 : rand(1, USERS), // user kh√¥ng t·ªìn t·∫°i
    shop_id: product.shop_id,
    product_id: product.product_id,
    variant_id:
      i % 77 === 0 ? 888888 : variant.variant_id, // variant kh√¥ng t·ªìn t·∫°i
    qty:
      i % 66 === 0 ? 999 : rand(1, 5), // oversell
    price_at_time:
      i % 44 === 0 ? -5000 : variant.price_override,
    voucher_used:
      i % 3 === 0 ? pick(vouchers).voucher_code : "INVALID_VOUCHER",
    order_status: pick([
      "CREATED",
      "PAID",
      "CANCELLED",
      "UNKNOWN"
    ]),
    order_time:
      product.is_flash_sale == 1
        ? "01/12/2023 20:00" // flash sale c√πng th·ªùi ƒëi·ªÉm
        : legacyDate()
  });
}

/* ================= WRITE FILES ================= */
fs.writeFileSync("legacy-users.json", JSON.stringify(users, null, 2));
fs.writeFileSync("legacy-shops.json", JSON.stringify(shops, null, 2));
fs.writeFileSync("legacy-products.json", JSON.stringify(products, null, 2));
fs.writeFileSync("legacy-variants.json", JSON.stringify(variants, null, 2));
fs.writeFileSync("legacy-vouchers.json", JSON.stringify(vouchers, null, 2));
fs.writeFileSync("legacy-orders.json", JSON.stringify(orders, null, 2));

console.log("üí£ Broken legacy e-commerce dataset generated");

üß™ C√°c l·ªói ƒë∆∞·ª£c c√†i c·∫Øm (t√≥m t·∫Øt)
Lo·∫°i l·ªói	V√≠ d·ª•
Oversell	qty = 999, stock_qty < 0
FK sai	order ‚Üí variant_id kh√¥ng t·ªìn t·∫°i
Voucher sai	percent > 100, code kh√¥ng t·ªìn t·∫°i
Gi√° l·ªói	price √¢m / =0
Date l·ªói	INVALID_DATE
Boolean lo·∫°n	0 / 1 / Y / N / "true"
Flash Sale	h√†ng ngh√¨n order c√πng timestamp
