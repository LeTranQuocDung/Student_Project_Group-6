2.1. E-Commerce Simulation (M√¥ h√¨nh Shopee/Lazada)

Th·ª±c th·ªÉ: User, Shop, Product (v·ªõi nhi·ªÅu bi·∫øn th·ªÉ Size/M√†u), Order, Voucher.

Th√°ch th·ª©c: X·ª≠ l√Ω gi·ªè h√†ng, t√≠nh to√°n khuy·∫øn m√£i ch·ªìng ch√©o, logic t·ªìn kho bi·∫øn th·ªÉ.

Simulator: Gi·∫£ l·∫≠p "Flash Sale" - h√†ng ngh√¨n user c√πng ƒë·∫∑t h√†ng m·ªôt l√∫c, h·ªá th·ªëng ph·∫£i tr·ª´ kho ch√≠nh x√°c.

Ch√†o b·∫°n, ch√∫ng ta s·∫Ω b·∫Øt ƒë·∫ßu l·∫°i t·ª´ ƒë·∫ßu v·ªõi ch·ªß ƒë·ªÅ E-Commerce Simulation n√†y. ƒê√¢y l√† ƒë·ªÅ t√†i kh√≥ nh·∫•t nh∆∞ng c≈©ng d·ªÖ l·∫•y ƒëi·ªÉm tuy·ªát ƒë·ªëi nh·∫•t n·∫øu b·∫°n l√†m r√µ ƒë∆∞·ª£c ph·∫ßn "Bi·∫øn th·ªÉ (Variants)" v√† "Flash Sale".

D∆∞·ªõi ƒë√¢y l√† quy tr√¨nh th·ª±c hi·ªán tr·ªçn g√≥i: T·ª´ thi·∫øt k·∫ø Database chu·∫©n ƒë·∫øn Code gi·∫£ l·∫≠p Flash Sale.

1. Thi·∫øt k·∫ø Database (Gi·∫£i quy·∫øt b√†i to√°n Bi·∫øn th·ªÉ)
Sai l·∫ßm l·ªõn nh·∫•t c·ªßa sinh vi√™n l√† ƒë·ªÉ c·ªôt Quantity (S·ªë l∆∞·ª£ng) ·ªü b·∫£ng Product. Th·ª±c t·∫ø: √Åo thun (Product) c√≥ th·ªÉ c√≤n m√†u ƒê·ªè nh∆∞ng h·∫øt m√†u Xanh. => Gi·∫£i ph√°p: T√°ch th√†nh 2 b·∫£ng Products (th√¥ng tin chung) v√† Product_Variants (th√¥ng tin SKU c·ª• th·ªÉ).

C·∫•u tr√∫c c√°c file CSV c·∫ßn t·∫°o:

shops.csv: ID, T√™n Shop, ƒê√°nh gi√°.

users.csv: ID, T√™n, V√≠ ti·ªÅn.

products.csv: ID, T√™n chung (VD: iPhone 15), M√¥ t·∫£.

product_variants.csv: Variant_ID, Product_ID, M√†u, Size, T·ªìn kho (Stock), Gi√°.

vouchers.csv: M√£, Lo·∫°i (Gi·∫£m ti·ªÅn/%, Freeship), ƒêi·ªÅu ki·ªán (ƒê∆°n t·ªëi thi·ªÉu).

orders.csv: ID ƒë∆°n, User mua, T·ªïng ti·ªÅn, Th·ªùi gian.

order_items.csv: ID chi ti·∫øt, Order_ID, Variant_ID (Link v√†o bi·∫øn th·ªÉ), S·ªë l∆∞·ª£ng.

2. Chi·∫øn thu·∫≠t gi·∫£ l·∫≠p "Flash Sale" (Simulator Strategy)
ƒê·ªÉ gi·∫£ l·∫≠p Flash Sale trong code sinh d·ªØ li·ªáu, ch√∫ng ta kh√¥ng random lung tung. Ch√∫ng ta s·∫Ω t·∫°o k·ªãch b·∫£n:

K·ªãch b·∫£n: Shop A m·ªü b√°n "iPhone 15 Pro Max - Titan T·ª± Nhi√™n" gi√° s·ªëc.

Kho: Ch·ªâ c√≥ 50 c√°i.

Ng∆∞·ªùi mua: 1.000 ng∆∞·ªùi c√πng lao v√†o ƒë·∫∑t l·ªánh.

K·∫øt qu·∫£ mong ƒë·ª£i: 50 ƒë∆°n h√†ng th√†nh c√¥ng, 950 ƒë∆°n h√†ng b·ªã h·ªßy ho·∫∑c b√°o l·ªói "H·∫øt h√†ng".

3. Code Java Tri·ªÉn khai (Full Script)
B·∫°n t·∫°o m·ªôt file Java m·ªõi t√™n EcommerceSimulator.java. Code n√†y s·∫Ω sinh ra b·ªô d·ªØ li·ªáu >10.000 d√≤ng th·ªÉ hi·ªán ƒë√∫ng k·ªãch b·∫£n tr√™n.

Java
import java.io.BufferedWriter;
import java.io.FileOutputStream;
import java.io.OutputStreamWriter;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.*;

public class EcommerceSimulator {

    // C·∫•u h√¨nh s·ªë l∆∞·ª£ng
    static final int NUM_USERS = 2000;      // 2000 ng∆∞·ªùi d√πng tham gia
    static final int NUM_SHOPS = 50;        // 50 Shop
    static final int NUM_PRODUCTS = 200;    // 200 S·∫£n ph·∫©m g·ªëc
    
    // List l∆∞u tr·ªØ ID ƒë·ªÉ t·∫°o quan h·ªá
    static List<String> userIds = new ArrayList<>();
    static List<String> shopIds = new ArrayList<>();
    static List<String> productIds = new ArrayList<>();
    static List<String> variantIds = new ArrayList<>();
    
    // Map gi·∫£ l·∫≠p kho h√†ng realtime cho Flash Sale (VariantID -> Stock)
    static Map<String, Integer> inventoryMap = new HashMap<>();

    static Random random = new Random();

    public static void main(String[] args) {
        System.out.println("üöÄ B·∫Øt ƒë·∫ßu gi·∫£ l·∫≠p h·ªá th·ªëng E-Commerce...");

        // 1. T·∫°o d·ªØ li·ªáu n·ªÅn (Master Data)
        generateUsers();
        generateShops();
        generateProductsAndVariants(); // Quan tr·ªçng: T·∫°o h√†ng h√≥a & Kho
        generateVouchers();

        // 2. GI·∫¢ L·∫¨P FLASH SALE (Transaction Data)
        // ƒê√¢y l√† ph·∫ßn "ƒÇn ƒëi·ªÉm": H√†ng ngh√¨n ng∆∞·ªùi tranh nhau mua
        simulateFlashSale(); 

        System.out.println("‚úÖ HO√ÄN T·∫§T! D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c xu·∫•t ra file CSV.");
    }

    // --- C√ÅC H√ÄM SINH D·ªÆ LI·ªÜU N·ªÄN ---

    static void generateUsers() {
        try (BufferedWriter writer = createWriter("users.csv")) {
            writer.write("user_id,username,email,phone\n");
            for (int i = 1; i <= NUM_USERS; i++) {
                String id = "U" + i;
                userIds.add(id);
                writer.write(id + ",user" + i + ",user" + i + "@mail.com,090" + i + "\n");
            }
            System.out.println("-> ƒê√£ t·∫°o " + NUM_USERS + " Users.");
        } catch (IOException e) { e.printStackTrace(); }
    }

    static void generateShops() {
        try (BufferedWriter writer = createWriter("shops.csv")) {
            writer.write("shop_id,shop_name,rating\n");
            for (int i = 1; i <= NUM_SHOPS; i++) {
                String id = "S" + i;
                shopIds.add(id);
                writer.write(id + ",Shop Official " + i + "," + (3 + random.nextDouble() * 2) + "\n");
            }
        } catch (IOException e) { e.printStackTrace(); }
    }

    static void generateProductsAndVariants() {
        try (BufferedWriter pWriter = createWriter("products.csv");
             BufferedWriter vWriter = createWriter("product_variants.csv")) {
            
            pWriter.write("product_id,shop_id,product_name,description\n");
            vWriter.write("variant_id,product_id,color,size,price,stock_qty\n");

            int vCount = 1;
            String[] products = {"iPhone 15", "Samsung S24", "√Åo Hoodie", "Gi√†y Nike", "Son Mac"};
            String[] colors = {"ƒêen", "Tr·∫Øng", "Titan", "H·ªìng", "Xanh"};
            String[] sizes = {"S", "M", "L", "XL", "256GB", "512GB"};

            for (int i = 1; i <= NUM_PRODUCTS; i++) {
                String pId = "P" + i;
                productIds.add(pId);
                String sId = shopIds.get(random.nextInt(shopIds.size()));
                String pName = products[random.nextInt(products.length)] + " " + i;

                pWriter.write(pId + "," + sId + "," + pName + ",M√¥ t·∫£ s·∫£n ph·∫©m x·ªãn\n");

                // T·∫°o bi·∫øn th·ªÉ (Variants) cho m·ªói s·∫£n ph·∫©m
                int numVars = 3 + random.nextInt(3); // M·ªói SP c√≥ 3-5 bi·∫øn th·ªÉ
                for (int j = 0; j < numVars; j++) {
                    String vId = "V" + vCount++;
                    variantIds.add(vId);
                    
                    String color = colors[random.nextInt(colors.length)];
                    String size = sizes[random.nextInt(sizes.length)];
                    double price = 100000 + random.nextInt(2000000);
                    int stock = random.nextInt(100); // Kho ng·∫´u nhi√™n

                    // L∆∞u v√†o Map ƒë·ªÉ l√°t n·ªØa gi·∫£ l·∫≠p tr·ª´ kho Flash Sale
                    inventoryMap.put(vId, stock);

                    vWriter.write(vId + "," + pId + "," + color + "," + size + "," + String.format("%.0f", price) + "," + stock + "\n");
                }
            }
            System.out.println("-> ƒê√£ t·∫°o Products & Variants (Logic t·ªìn kho t√°ch bi·ªát).");
        } catch (IOException e) { e.printStackTrace(); }
    }
    
    static void generateVouchers() {
        try (BufferedWriter writer = createWriter("vouchers.csv")) {
            writer.write("voucher_id,code,discount_percent,min_order\n");
            for(int i=1; i<=20; i++) {
                writer.write("VC"+i + ",SALE"+i + "," + (5+random.nextInt(20)) + "," + (100000*i) + "\n");
            }
        } catch (IOException e) { e.printStackTrace(); }
    }

    // --- PH·∫¶N QUAN TR·ªåNG: GI·∫¢ L·∫¨P FLASH SALE ---
    static void generateOrders_SimulateFlashSale() {
        // T√™n h√†m c≈©, ƒë·ªïi t√™n l·∫°i cho ƒë√∫ng logic b√™n d∆∞·ªõi
    }

    static void simulateFlashSale() {
        System.out.println("‚ö° ƒêANG GI·∫¢ L·∫¨P FLASH SALE: 1000 ng∆∞·ªùi c√πng tranh mua 1 s·∫£n ph·∫©m HOT...");
        
        try (BufferedWriter oWriter = createWriter("orders.csv");
             BufferedWriter oiWriter = createWriter("order_items.csv")) {
             
            oWriter.write("order_id,user_id,total_amount,status,order_time\n");
            oiWriter.write("item_id,order_id,variant_id,quantity,price\n");

            // K·ªãch b·∫£n: Ch·ªçn 1 s·∫£n ph·∫©m HOT nh·∫•t ƒë·ªÉ l√†m Flash Sale
            String hotVariantId = variantIds.get(0); // L·∫•y bi·∫øn th·ªÉ ƒë·∫ßu ti√™n
            int initialStock = inventoryMap.get(hotVariantId); 
            System.out.println("   M·∫∑t h√†ng HOT: " + hotVariantId + " | T·ªìn kho ban ƒë·∫ßu: " + initialStock);

            int orderCount = 1;
            int orderItemCount = 1;

            // 1500 l∆∞·ª£t request mua h√†ng d·ªìn d·∫≠p
            for (int i = 0; i < 1500; i++) {
                String userId = userIds.get(random.nextInt(userIds.size()));
                int qtyBuy = 1; // M·ªói ng∆∞·ªùi mua 1 c√°i

                // LOGIC KI·ªÇM TRA T·ªíN KHO (Concurrency Simulation Logic)
                String status;
                synchronized (inventoryMap) { // Gi·∫£ l·∫≠p kh√≥a (lock) kho h√†ng
                    int currentStock = inventoryMap.getOrDefault(hotVariantId, 0);
                    
                    if (currentStock >= qtyBuy) {
                        // C√≤n h√†ng -> Tr·ª´ kho -> T·∫°o ƒë∆°n th√†nh c√¥ng
                        inventoryMap.put(hotVariantId, currentStock - qtyBuy);
                        status = "Completed";
                    } else {
                        // H·∫øt h√†ng -> ƒê∆°n b·ªã h·ªßy
                        status = "Cancelled (Out of Stock)";
                    }
                }

                // Ghi log ƒë∆°n h√†ng
                String orderId = "OD" + orderCount++;
                oWriter.write(orderId + "," + userId + ",1000000," + status + ",2024-06-06 12:00:00\n");

                // N·∫øu th√†nh c√¥ng th√¨ ghi chi ti·∫øt ƒë∆°n h√†ng
                if (status.equals("Completed")) {
                    oiWriter.write("IT" + orderItemCount++ + "," + orderId + "," + hotVariantId + "," + qtyBuy + ",1000000\n");
                }
            }
            
            System.out.println("   K·∫øt qu·∫£ Flash Sale: Kho c√≤n l·∫°i = " + inventoryMap.get(hotVariantId));
            
            // T·∫°o th√™m c√°c ƒë∆°n h√†ng l·∫ª t·∫ª kh√°c cho ƒë·ªß 10.000 d√≤ng
            System.out.println("‚ö° ƒêang t·∫°o th√™m c√°c ƒë∆°n h√†ng th∆∞·ªùng cho ƒë·ªß KPI...");
            for(int i=0; i<8500; i++) {
                 String userId = userIds.get(random.nextInt(userIds.size()));
                 String randVid = variantIds.get(random.nextInt(variantIds.size()));
                 String oId = "OD_REG_" + i;
                 oWriter.write(oId + "," + userId + ",500000,Completed,2024-06-07\n");
                 oiWriter.write("IT_REG_" + i + "," + oId + "," + randVid + ",1,500000\n");
            }

        } catch (IOException e) { e.printStackTrace(); }
    }

    // Ti·ªán √≠ch ghi file
    static BufferedWriter createWriter(String fileName) throws IOException {
        BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(fileName), StandardCharsets.UTF_8));
        writer.write("\uFEFF"); // BOM
        return writer;
    }
}

t·∫°o b·ªô d·ªØ li·ªáu m·∫´u legacy data b·∫±ng script >10000 d√≤ng c·ªë t√¨nh c√†i c·∫Øm l·ªói sai format

ƒê√¢y l√† m·ªôt chi·∫øn l∆∞·ª£c r·∫•t th√¥ng minh ƒë·ªÉ "ghi ƒëi·ªÉm" trong m·∫Øt gi·∫£ng vi√™n. Vi·ªác c√≥ m·ªôt b·ªô d·ªØ li·ªáu "Legacy" (D·ªØ li·ªáu c≈© t·ª´ h·ªá th·ªëng kh√°c) ƒë·∫ßy l·ªói gi√∫p b·∫°n ch·ª©ng minh ƒë∆∞·ª£c t√≠nh nƒÉng Data Cleaning (L√†m s·∫°ch d·ªØ li·ªáu) ho·∫∑c ETL (Extract - Transform - Load) c·ªßa h·ªá th·ªëng m·ªõi.

D∆∞·ªõi ƒë√¢y l√† script Java ƒë·ªÉ sinh ra file legacy_products_raw.csv g·ªìm 12.500 d√≤ng, trong ƒë√≥ ch·ª©a kho·∫£ng 20% d·ªØ li·ªáu b·ªã l·ªói format (gi√° d√≠nh ch·ªØ, ng√†y th√°ng sai, null, tr√πng l·∫∑p...).

1. Code Sinh D·ªØ Li·ªáu "B·∫©n" (LegacyDataGenerator.java)
B·∫°n t·∫°o file LegacyDataGenerator.java v√† ch·∫°y code sau:

Java
import java.io.BufferedWriter;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStreamWriter;
import java.nio.charset.StandardCharsets;
import java.util.Random;

public class LegacyDataGenerator {

    public static void main(String[] args) {
        String fileName = "legacy_products_raw.csv";
        int totalRows = 12500; // > 10.000 d√≤ng theo y√™u c·∫ßu

        // D·ªØ li·ªáu m·∫´u ƒë·ªÉ gh√©p t√™n
        String[] brands = {"Samsung", "Apple", "Xiaomi", "Oppo", "Sony", "LG", "Nokia"};
        String[] types = {"Dien thoai", "May tinh bang", "Tai nghe", "Sac du phong", "Op lung"};
        String[] statusList = {"New", "Old", "Refurbished", "Unknown"};

        try (BufferedWriter writer = new BufferedWriter(
                new OutputStreamWriter(new FileOutputStream(fileName), StandardCharsets.UTF_8))) {

            // 1. Ghi BOM ƒë·ªÉ m·ªü Excel kh√¥ng l·ªói font
            writer.write("\uFEFF");

            // 2. Header ki·ªÉu c≈© (Vi·∫øt hoa, kh√¥ng chu·∫©n convention)
            writer.write("PROD_ID,PROD_NAME,PRICE_RAW,STOCK_QTY,IMPORT_DATE,STATUS,NOTE\n");

            Random random = new Random();

            for (int i = 1; i <= totalRows; i++) {
                boolean isErrorRow = random.nextInt(100) < 20; // 20% d√≤ng s·∫Ω b·ªã l·ªói format

                // --- A. T·∫°o d·ªØ li·ªáu chu·∫©n tr∆∞·ªõc ---
                String id = String.valueOf(1000 + i);
                String name = types[random.nextInt(types.length)] + " " + brands[random.nextInt(brands.length)] + " " + i;
                
                double realPrice = 100000 + random.nextInt(9000000);
                String priceStr = String.format("%.0f", realPrice); // Gi√° chu·∫©n: 150000
                
                int realStock = random.nextInt(500);
                String stockStr = String.valueOf(realStock); // T·ªìn kho chu·∫©n: 50
                
                // Ng√†y chu·∫©n: YYYY-MM-DD
                String dateStr = "2023-" + (1 + random.nextInt(12)) + "-" + (1 + random.nextInt(28));
                String status = statusList[random.nextInt(statusList.length)];
                String note = "";

                // --- B. C·ªë t√¨nh ph√° ho·∫°i (Inject Errors) ---
                if (isErrorRow) {
                    int errorType = random.nextInt(6); // Random 6 ki·ªÉu l·ªói ph·ªï bi·∫øn
                    
                    switch (errorType) {
                        case 0: // L·ªói Gi√°: D√≠nh ch·ªØ "k", "ƒë", d·∫•u ph·∫©y
                            if (random.nextBoolean()) {
                                priceStr = (realPrice / 1000) + "k"; // VD: 150k
                            } else {
                                priceStr = String.format("%,.0f", realPrice) + " vnd"; // VD: 150,000 vnd
                            }
                            note = "ERR_FORMAT_PRICE";
                            break;

                        case 1: // L·ªói T·ªìn kho: S·ªë √¢m ho·∫∑c ch·ªØ
                            if (random.nextBoolean()) {
                                stockStr = "-" + random.nextInt(10); // VD: -5
                            } else {
                                stockStr = "Out of Stock"; // VD: Ch·ªØ thay v√¨ s·ªë
                            }
                            note = "ERR_LOGIC_STOCK";
                            break;

                        case 2: // L·ªói Ng√†y th√°ng: ƒê·ªãnh d·∫°ng sai ho·∫∑c ng√†y kh√¥ng t·ªìn t·∫°i
                            dateStr = "13/20/2023"; // Th√°ng 20?
                            note = "ERR_FORMAT_DATE";
                            break;

                        case 3: // L·ªói Null: D·ªØ li·ªáu quan tr·ªçng b·ªã r·ªóng
                            name = "";
                            note = "ERR_MISSING_NAME";
                            break;

                        case 4: // L·ªói Tr√πng l·∫∑p ID (Duplicate Key)
                            id = String.valueOf(1000 + i - 1); // Tr√πng v·ªõi d√≤ng tr∆∞·ªõc ƒë√≥
                            note = "ERR_DUPLICATE_ID";
                            break;
                            
                        case 5: // L·ªói Encoding/R√°c
                            name = "#N/A @ERROR!!!";
                            break;
                    }
                }

                // Ghi v√†o file
                writer.write(id + "," + name + "," + priceStr + "," + stockStr + "," + dateStr + "," + status + "," + note + "\n");
            }

            System.out.println("‚úÖ ƒê√£ t·∫°o xong file " + fileName + " (" + totalRows + " d√≤ng).");
            System.out.println("‚ö†Ô∏è C·∫£nh b√°o: File ch·ª©a nhi·ªÅu l·ªói ƒë·ªãnh d·∫°ng ƒë·ªÉ test Data Cleaning.");

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}