Flow Checkout & Voucher
OK, m√¨nh l√†m ri√™ng tr·ªçn g√≥i ph·∫ßn ‚ÄúFlow Checkout & Voucher‚Äù ƒë·ªÉ b·∫°n giao cho 1 ng∆∞·ªùi trong nh√≥m l√† d√πng ƒë∆∞·ª£c ngay üëå
(ƒë√∫ng ki·ªÉu th·∫ßy/c√¥ h·ªèi l√† b·∫£o v·ªá ƒë∆∞·ª£c)

FLOW CHECKOUT & VOUCHER

(Ph·∫ßn c·ªßa 1 th√†nh vi√™n trong nh√≥m)

1. M·ª•c ti√™u ch·ª©c nƒÉng

X·ª≠ l√Ω ƒë·∫∑t h√†ng (Checkout)

√Åp d·ª•ng Flash Sale + Voucher

ƒê·∫£m b·∫£o:

T√≠nh gi√° ƒë√∫ng

Kh√¥ng √°p d·ª•ng sai voucher

Kh√¥ng t·∫°o ƒë∆°n khi h·∫øt h√†ng

2. C√°c lo·∫°i khuy·∫øn m√£i trong h·ªá th·ªëng
2.1 Flash Sale

√Åp d·ª•ng tr·ª±c ti·∫øp l√™n Product Variant

Gi·∫£m gi√° tr∆∞·ªõc khi t√≠nh voucher

C√≥ gi·ªõi h·∫°n th·ªùi gian v√† s·ªë l∆∞·ª£ng

2.2 Voucher
Lo·∫°i	ƒê·∫∑c ƒëi·ªÉm
Voucher Shop	√Åp d·ª•ng cho s·∫£n ph·∫©m c·ªßa 1 shop
Voucher S√†n	√Åp d·ª•ng to√†n ƒë∆°n
Free ship	C√≥ th·ªÉ g·ªôp

üëâ Th·ª© t·ª± √°p d·ª•ng (r·∫•t quan tr·ªçng)

Flash Sale

Voucher Shop

Voucher S√†n

3. FLOWCHART: CHECKOUT & VOUCHER (CHI TI·∫æT)
Flow t·ªïng qu√°t
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User Click       ‚îÇ
‚îÇ Checkout         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Ki·ªÉm tra ƒëƒÉng nh·∫≠p     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ L·∫•y Cart t·ª´ Session    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Cart r·ªóng?             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇYes      ‚îÇNo
        ‚Üì         ‚Üì
   [D·ª´ng]   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ T√≠nh gi√° g·ªëc t·ª´ng item  ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √Åp d·ª•ng Flash Sale     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √Åp d·ª•ng Voucher Shop   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ √Åp d·ª•ng Voucher S√†n    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ T√≠nh Final Amount      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ X√°c nh·∫≠n ƒë·∫∑t h√†ng      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BEGIN TRANSACTION      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Kh√≥a kho Variant       ‚îÇ
‚îÇ (SELECT FOR UPDATE)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Stock ƒë·ªß?              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇNo       ‚îÇYes
        ‚Üì         ‚Üì
 [ROLLBACK]   [Tr·ª´ kho]
                    ‚Üì
             [T·∫°o Order]
                    ‚Üì
               [COMMIT]

4. FLOW T√çNH VOUCHER (CHUY√äN S√ÇU ‚Äì ƒÇN ƒêI·ªÇM)
Flow √°p d·ª•ng Voucher
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Ng∆∞·ªùi d√πng nh·∫≠p voucher‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Voucher t·ªìn t·∫°i?       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇNo       ‚îÇYes
        ‚Üì         ‚Üì
 [B·ªè qua]  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ Voucher c√≤n hi·ªáu l·ª±c?  ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇNo       ‚îÇYes
                   ‚Üì         ‚Üì
              [B·ªè qua] ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ ƒê·ªß min order value?   ‚îÇ
                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇNo       ‚îÇYes
                               ‚Üì         ‚Üì
                          [B·ªè qua] ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                   ‚îÇ T√≠nh discount          ‚îÇ
                                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                           ‚Üì
                                   [√Åp d·ª•ng (c√≥ max cap)]
mermaid

Tuy·ªát üëç d∆∞·ªõi ƒë√¢y l√† MERMAID CHU·∫®N cho Flow Checkout & Voucher.
B·∫°n copy d√°n tr·ª±c ti·∫øp v√†o Mermaid Live / draw.io (Mermaid) l√† render ƒë∆∞·ª£c ngay.

1Ô∏è‚É£ FLOW CHECKOUT & VOUCHER (MERMAID)
flowchart TD
    A[User click Checkout] --> B{ƒê√£ ƒëƒÉng nh·∫≠p?}
    B -- No --> B1[Chuy·ªÉn t·ªõi Login]
    B -- Yes --> C[L·∫•y Cart t·ª´ Session]

    C --> D{Cart r·ªóng?}
    D -- Yes --> D1[D·ª´ng Checkout]
    D -- No --> E[T√≠nh gi√° g·ªëc t·ª´ng s·∫£n ph·∫©m]

    E --> F[√Åp d·ª•ng Flash Sale]
    F --> G[√Åp d·ª•ng Voucher Shop]
    G --> H[√Åp d·ª•ng Voucher S√†n]

    H --> I[T√≠nh Final Amount]
    I --> J[User x√°c nh·∫≠n ƒë·∫∑t h√†ng]

    J --> K[BEGIN TRANSACTION]
    K --> L[Kh√≥a kho Product Variant<br/>(SELECT FOR UPDATE)]

    L --> M{Stock ƒë·ªß?}
    M -- No --> N[ROLLBACK<br/>Th√¥ng b√°o h·∫øt h√†ng]
    M -- Yes --> O[Tr·ª´ kho Variant]

    O --> P[T·∫°o Order + Order Items]
    P --> Q[COMMIT]
    Q --> R[ƒê·∫∑t h√†ng th√†nh c√¥ng]

2Ô∏è‚É£ FLOW √ÅP D·ª§NG VOUCHER (MERMAID)
flowchart TD
    A[User nh·∫≠p Voucher] --> B{Voucher t·ªìn t·∫°i?}
    B -- No --> X[B·ªè qua Voucher]
    B -- Yes --> C{C√≤n hi·ªáu l·ª±c?}

    C -- No --> X
    C -- Yes --> D{ƒê·∫°t min order value?}

    D -- No --> X
    D -- Yes --> E[T√≠nh discount]

    E --> F{C√≥ max discount?}
    F -- Yes --> G[√Åp d·ª•ng gi·ªõi h·∫°n gi·∫£m gi√°]
    F -- No --> H[√Åp d·ª•ng to√†n b·ªô]

    G --> I[Voucher h·ª£p l·ªá]
    H --> I
cho t√¥i class diagram n·ªØa

OK üëç m√¨nh ƒë∆∞a CLASS DIAGRAM b·∫±ng MERMAID ‚Äì b·∫£n an to√†n nh·∫•t, ƒë√£ gi·∫£m k√Ω t·ª± l·ªói, kh√¥ng d·∫•u, d√πng chu·∫©n classDiagram (·ªïn ƒë·ªãnh h∆°n flowchart).

üëâ Ph√π h·ª£p n·ªôp cho OOP / CNPM / Java / UML

‚úÖ CLASS DIAGRAM ‚Äì E-COMMERCE (MERMAID)

üëâ Copy nguy√™n kh·ªëi

classDiagram
    class User {
        int userId
        string username
        string email
        string password
    }

    class Shop {
        int shopId
        string shopName
        float rating
    }

    class Product {
        int productId
        string name
        float basePrice
        string status
    }

    class ProductVariant {
        int variantId
        string size
        string color
        float price
        int stock
    }

    class Cart {
        int cartId
        datetime createdAt
    }

    class CartItem {
        int cartItemId
        int quantity
    }

    class Order {
        int orderId
        float totalAmount
        float discountAmount
        float finalAmount
        string status
    }

    class OrderItem {
        int orderItemId
        float price
        int quantity
    }

    class Voucher {
        int voucherId
        string code
        string type
        float value
        float minOrder
        float maxDiscount
    }

    User "1" --> "1" Cart
    User "1" --> "0..*" Order
    User "1" --> "0..*" Shop

    Shop "1" --> "0..*" Product
    Product "1" --> "0..*" ProductVariant

    Cart "1" --> "0..*" CartItem
    CartItem "*" --> "1" ProductVariant

    Order "1" --> "0..*" OrderItem
    OrderItem "*" --> "1" ProductVariant

    Order "0..*" --> "0..*" Voucher
d√πng file md
üìÑ FILE .md HO√ÄN CH·ªàNH (B·∫†N COPY D√ôNG LU√îN)

üëâ T·∫°o file:

checkout_voucher.md

‚úèÔ∏è N·ªòI DUNG FILE checkout_voucher.md
# Flow Checkout & Voucher

## 1. Checkout Flow

```mermaid
graph TD
    A[Checkout] --> B{Login}
    B -->|No| B1[Go Login]
    B -->|Yes| C[Get Cart]

    C --> D{Empty Cart}
    D -->|Yes| D1[Stop]
    D -->|No| E[Calc Base Price]

    E --> F[Apply Flash Sale]
    F --> G[Apply Shop Voucher]
    G --> H[Apply Platform Voucher]

    H --> I[Calc Final Amount]
    I --> J[Confirm Order]

    J --> K[Begin Transaction]
    K --> L[Lock Stock]

    L --> M{Stock OK}
    M -->|No| N[Rollback]
    M -->|Yes| O[Update Stock]

    O --> P[Create Order]
    P --> Q[Commit]
    Q --> R[Success]
```

---

## 2. Voucher Apply Flow

```mermaid
graph TD
    A[Input Voucher] --> B{Exist}
    B -->|No| X[Ignore]
    B -->|Yes| C{Valid}

    C -->|No| X
    C -->|Yes| D{Min Order OK}

    D -->|No| X
    D -->|Yes| E[Calc Discount]

    E --> F{Has Max Cap}
    F -->|Yes| G[Apply Cap]
    F -->|No| H[Apply Discount]

    G --> I[Voucher OK]
    H --> I
```

---

## 3. Class Diagram - Checkout Module

```mermaid
classDiagram
    class Cart {
        int cartId
        getItems()
    }

    class CartItem {
        int quantity
    }

    class ProductVariant {
        int variantId
        float price
        int stock
    }

    class Voucher {
        string code
        string type
        float value
    }

    class Order {
        int orderId
        float finalAmount
        create()
    }

    class CheckoutService {
        calculatePrice()
        applyVoucher()
        createOrder()
    }

    Cart "1" --> "0..*" CartItem
    CartItem "*" --> "1" ProductVariant
    Order "1" --> "0..*" ProductVariant
    CheckoutService --> Cart
    CheckoutService --> Order
    CheckoutService --> Voucher
```

---
