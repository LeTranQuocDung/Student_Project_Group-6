/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/10.1.19
 * Generated at: 2026-03-01 13:27:27 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp;

import jakarta.servlet.*;
import jakarta.servlet.http.*;
import jakarta.servlet.jsp.*;
import model.Cart;
import model.CartItem;

public final class cart_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent,
                 org.apache.jasper.runtime.JspSourceImports,
                 org.apache.jasper.runtime.JspSourceDirectives {

  private static final jakarta.servlet.jsp.JspFactory _jspxFactory =
          jakarta.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private static final java.util.Set<java.lang.String> _jspx_imports_packages;

  private static final java.util.Set<java.lang.String> _jspx_imports_classes;

  static {
    _jspx_imports_packages = new java.util.LinkedHashSet<>(3);
    _jspx_imports_packages.add("jakarta.servlet");
    _jspx_imports_packages.add("jakarta.servlet.http");
    _jspx_imports_packages.add("jakarta.servlet.jsp");
    _jspx_imports_classes = new java.util.LinkedHashSet<>(2);
    _jspx_imports_classes.add("model.CartItem");
    _jspx_imports_classes.add("model.Cart");
  }

  private volatile jakarta.el.ExpressionFactory _el_expressionfactory;
  private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public java.util.Set<java.lang.String> getPackageImports() {
    return _jspx_imports_packages;
  }

  public java.util.Set<java.lang.String> getClassImports() {
    return _jspx_imports_classes;
  }

  public boolean getErrorOnELNotFound() {
    return false;
  }

  public jakarta.el.ExpressionFactory _jsp_getExpressionFactory() {
    if (_el_expressionfactory == null) {
      synchronized (this) {
        if (_el_expressionfactory == null) {
          _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
        }
      }
    }
    return _el_expressionfactory;
  }

  public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
    if (_jsp_instancemanager == null) {
      synchronized (this) {
        if (_jsp_instancemanager == null) {
          _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
        }
      }
    }
    return _jsp_instancemanager;
  }

  public void _jspInit() {
  }

  public void _jspDestroy() {
  }

  public void _jspService(final jakarta.servlet.http.HttpServletRequest request, final jakarta.servlet.http.HttpServletResponse response)
      throws java.io.IOException, jakarta.servlet.ServletException {

    if (!jakarta.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
      final java.lang.String _jspx_method = request.getMethod();
      if ("OPTIONS".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        return;
      }
      if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method)) {
        response.setHeader("Allow","GET, HEAD, POST, OPTIONS");
        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
        return;
      }
    }

    final jakarta.servlet.jsp.PageContext pageContext;
    jakarta.servlet.http.HttpSession session = null;
    final jakarta.servlet.ServletContext application;
    final jakarta.servlet.ServletConfig config;
    jakarta.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    jakarta.servlet.jsp.JspWriter _jspx_out = null;
    jakarta.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("    \r\n");
      out.write("        \r\n");
      out.write("            <!DOCTYPE html>\r\n");
      out.write("            <html lang=\"vi\">\r\n");
      out.write("\r\n");
      out.write("            <head>\r\n");
      out.write("                <meta charset=\"UTF-8\">\r\n");
      out.write("                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n");
      out.write("                <title>Giỏ Hàng - Shopee Clone</title>\r\n");
      out.write("                <link rel=\"stylesheet\" href=\"css/cart.css\">\r\n");
      out.write("                <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap\"\r\n");
      out.write("                    rel=\"stylesheet\">\r\n");
      out.write("                <!-- FontAwesome -->\r\n");
      out.write("                <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\r\n");
      out.write("            </head>\r\n");
      out.write("\r\n");
      out.write("            <body>\r\n");
      out.write("                <!-- Header Desktop -->\r\n");
      out.write("                <header class=\"desktop-header desktop-only\">\r\n");
      out.write("                    <div class=\"container header-inner\">\r\n");
      out.write("                        <div class=\"header-logo\">\r\n");
      out.write("                            <a href=\"home\" style=\"text-decoration:none; display:flex; align-items:center; gap:10px;\">\r\n");
      out.write("                                <i class=\"fa-solid fa-bag-shopping\" style=\"color: var(--primary); font-size: 32px;\"></i>\r\n");
      out.write("                                <h1 class=\"header-title\" style=\"color:var(--primary); margin:0;\">Shopee Giỏ Hàng</h1>\r\n");
      out.write("                            </a>\r\n");
      out.write("                        </div>\r\n");
      out.write("                        <div class=\"header-search\">\r\n");
      out.write("                            <input type=\"text\" placeholder=\"Freeship 0Đ (*)\" aria-label=\"Tìm kiếm\">\r\n");
      out.write("                            <button><i class=\"fa-solid fa-magnifying-glass\"></i></button>\r\n");
      out.write("                        </div>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </header>\r\n");
      out.write("\r\n");
      out.write("                <!-- Mobile Toggle Button (to simulate opening cart panel) -->\r\n");
      out.write("                <button id=\"mobileOpenCartBtn\" class=\"mobile-only mobile-open-btn\" aria-label=\"Mở giỏ hàng\">\r\n");
      out.write("                    <i class=\"fa-solid fa-cart-shopping\"></i> Mở Giỏ Hàng\r\n");
      out.write("                </button>\r\n");
      out.write("\r\n");
      out.write("                <!-- Mobile Cart Overlay -->\r\n");
      out.write("                <div id=\"cartOverlay\" class=\"cart-overlay\" aria-hidden=\"true\"></div>\r\n");
      out.write("\r\n");
      out.write("                <!-- Cart Main Container -->\r\n");
      out.write("                <div id=\"cartPanel\" class=\"cart-panel\">\r\n");
      out.write("                    ");
 Cart cart=(Cart) session.getAttribute("cart"); int totalQty=(cart !=null) ?
                        cart.getTotalQuantity() : 0; java.math.BigDecimal totalMoney=(cart !=null) ?
                        cart.getTotalMoney() : java.math.BigDecimal.ZERO; int totalItems=(cart !=null && cart.getItems()
                        !=null) ? cart.getItems().size() : 0; 
      out.write("\r\n");
      out.write("\r\n");
      out.write("                        <div class=\"cart-panel-header mobile-only\">\r\n");
      out.write("                            <h2>Giỏ Hàng (<span id=\"mobileCartCount\">\r\n");
      out.write("                                    ");
      out.print( totalQty );
      out.write("\r\n");
      out.write("                                </span>)</h2>\r\n");
      out.write("                            <button id=\"closeCartBtn\" class=\"close-btn\" aria-label=\"Đóng\"><i\r\n");
      out.write("                                    class=\"fa-solid fa-xmark\"></i></button>\r\n");
      out.write("                        </div>\r\n");
      out.write("\r\n");
      out.write("                        <div class=\"container main-content\">\r\n");
      out.write("\r\n");
      out.write("                            ");
 if (cart==null || cart.getItems().isEmpty()) { 
      out.write("\r\n");
      out.write("                                <!-- Empty State -->\r\n");
      out.write("                                <div id=\"emptyState\" class=\"empty-state\">\r\n");
      out.write("                                    <i class=\"fa-solid fa-cart-arrow-down empty-icon\"></i>\r\n");
      out.write("                                    <p>Giỏ hàng của bạn còn trống</p>\r\n");
      out.write("                                    <button class=\"btn-checkout\" onclick=\"window.location.href='home'\">MUA SẮM\r\n");
      out.write("                                        NGAY</button>\r\n");
      out.write("                                </div>\r\n");
      out.write("                                ");
 } else { 
      out.write("\r\n");
      out.write("\r\n");
      out.write("                                    <div id=\"cartContent\" class=\"cart-content\">\r\n");
      out.write("                                        <!-- Desktop Table Header -->\r\n");
      out.write("                                        <div class=\"cart-table-header desktop-only\">\r\n");
      out.write("                                            <label class=\"checkbox-container\">\r\n");
      out.write("                                                <input type=\"checkbox\" id=\"selectAllTop\" aria-label=\"Chọn tất cả\"\r\n");
      out.write("                                                    checked>\r\n");
      out.write("                                                <span class=\"checkmark\"></span>\r\n");
      out.write("                                                Sản Phẩm\r\n");
      out.write("                                            </label>\r\n");
      out.write("                                            <div class=\"col-price\">Đơn Giá</div>\r\n");
      out.write("                                            <div class=\"col-qty\">Số Lượng</div>\r\n");
      out.write("                                            <div class=\"col-subtotal\">Số Tiền</div>\r\n");
      out.write("                                            <div class=\"col-actions\">Thao Tác</div>\r\n");
      out.write("                                        </div>\r\n");
      out.write("\r\n");
      out.write("                                        <!-- Rendered Cart Items -->\r\n");
      out.write("                                        <div id=\"cartItemsContainer\" aria-live=\"polite\">\r\n");
      out.write("                                            <div class=\"shop-group\">\r\n");
      out.write("                                                <div class=\"shop-header\">\r\n");
      out.write("                                                    <label class=\"checkbox-container\">\r\n");
      out.write("                                                        <input type=\"checkbox\" class=\"shop-checkbox\"\r\n");
      out.write("                                                            aria-label=\"Chọn shop\" checked>\r\n");
      out.write("                                                        <span class=\"checkmark\"></span>\r\n");
      out.write("                                                    </label>\r\n");
      out.write("                                                    <span class=\"shop-tag\">Yêu thích+</span>\r\n");
      out.write("                                                    <span class=\"shop-name\">Shopee Official Store</span>\r\n");
      out.write("                                                    <i class=\"fa-solid fa-message\"\r\n");
      out.write("                                                        style=\"color: var(--primary); margin-left: 5px;\"></i>\r\n");
      out.write("                                                </div>\r\n");
      out.write("\r\n");
      out.write("                                                <div class=\"shop-items\">\r\n");
      out.write("                                                    ");
 for (CartItem i : cart.getItems()) { java.math.BigDecimal
                                                        oldPrice=i.getPrice().multiply(new java.math.BigDecimal("1.2"));
                                                        
      out.write("\r\n");
      out.write("                                                        <div class=\"product-item\">\r\n");
      out.write("                                                            <div class=\"product-info\">\r\n");
      out.write("                                                                <label class=\"checkbox-container\">\r\n");
      out.write("                                                                    <input type=\"checkbox\" class=\"item-checkbox\"\r\n");
      out.write("                                                                        data-id=\"");
      out.print( i.getProduct().getId() );
      out.write("\"\r\n");
      out.write("                                                                        data-price=\"");
      out.print( i.getPrice() );
      out.write("\"\r\n");
      out.write("                                                                        data-qty=\"");
      out.print( i.getQuantity() );
      out.write("\"\r\n");
      out.write("                                                                        onchange=\"calculateTotal()\" checked\r\n");
      out.write("                                                                        aria-label=\"Chọn ");
      out.print( i.getProduct().getName() );
      out.write("\">\r\n");
      out.write("                                                                    <span class=\"checkmark\"></span>\r\n");
      out.write("                                                                </label>\r\n");
      out.write("                                                                <a\r\n");
      out.write("                                                                    href=\"product_detail?id=");
      out.print( i.getProduct().getId());
      out.write("\">\r\n");
      out.write("                                                                    <img src=\"");
      out.print( i.getProduct().getImageUrl() );
      out.write("\"\r\n");
      out.write("                                                                        alt=\"");
      out.print( i.getProduct().getName() );
      out.write("\"\r\n");
      out.write("                                                                        class=\"product-img\" loading=\"lazy\">\r\n");
      out.write("                                                                </a>\r\n");
      out.write("                                                                <div class=\"product-details\">\r\n");
      out.write("                                                                    <div class=\"product-title\">\r\n");
      out.write("                                                                        <a href=\"product_detail?id=");
      out.print( i.getProduct().getId());
      out.write("\"\r\n");
      out.write("                                                                            style=\"text-decoration:none; color:inherit;\">\r\n");
      out.write("                                                                            ");
      out.print( i.getProduct().getName() );
      out.write("\r\n");
      out.write("                                                                        </a>\r\n");
      out.write("                                                                    </div>\r\n");
      out.write("                                                                    <div class=\"product-campaign\">Free Ship</div>\r\n");
      out.write("                                                                    <div class=\"col-attr mobile-only\"\r\n");
      out.write("                                                                        style=\"display:block; font-size:12px; color:#888; margin-top:4px;\">\r\n");
      out.write("                                                                        Phân loại hàng: Mặc định</div>\r\n");
      out.write("                                                                    <img src=\"https://down-vn.img.susercontent.com/file/vn-50009109-c7a2e1ae720f9704f92f72c9ef1a494a\"\r\n");
      out.write("                                                                        style=\"height:15px; margin-top:5px; align-self:flex-start;\"\r\n");
      out.write("                                                                        alt=\"freeship extra\">\r\n");
      out.write("                                                                </div>\r\n");
      out.write("                                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                                            <div class=\"col-attr desktop-only\">\r\n");
      out.write("                                                                <div>Phân loại hàng: </div>\r\n");
      out.write("                                                                <div>Mặc định</div>\r\n");
      out.write("                                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                                            <div class=\"item-price desktop-only\">\r\n");
      out.write("                                                                <span class=\"price-old\">₫");
      out.print( String.format("%,.0f",
                                                                        oldPrice) );
      out.write("</span>\r\n");
      out.write("                                                                <span class=\"price-new\">₫");
      out.print( String.format("%,.0f",
                                                                        i.getPrice()) );
      out.write("</span>\r\n");
      out.write("                                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                                            <div class=\"mobile-price-qty mobile-only\">\r\n");
      out.write("                                                                <span class=\"mobile-price\">₫");
      out.print( String.format("%,.0f",
                                                                        i.getPrice()) );
      out.write("</span>\r\n");
      out.write("                                                                <div class=\"qty-control\" style=\"width:auto;\">\r\n");
      out.write("                                                                    <div class=\"qty-wrapper\">\r\n");
      out.write("                                                                        <button type=\"button\" class=\"qty-btn\"\r\n");
      out.write("                                                                            onclick=\"updateQty(");
      out.print( i.getProduct().getId() );
      out.write(", -1, ");
      out.print( i.getQuantity() );
      out.write(")\"\r\n");
      out.write("                                                                            aria-label=\"Giảm\">-</button>\r\n");
      out.write("                                                                        <input type=\"text\" class=\"qty-input\"\r\n");
      out.write("                                                                            value=\"");
      out.print( i.getQuantity() );
      out.write("\" readonly\r\n");
      out.write("                                                                            aria-label=\"Số lượng\">\r\n");
      out.write("                                                                        <button type=\"button\" class=\"qty-btn\"\r\n");
      out.write("                                                                            onclick=\"updateQty(");
      out.print( i.getProduct().getId() );
      out.write(", 1, ");
      out.print( i.getQuantity() );
      out.write(")\"\r\n");
      out.write("                                                                            aria-label=\"Tăng\">+</button>\r\n");
      out.write("                                                                    </div>\r\n");
      out.write("                                                                </div>\r\n");
      out.write("                                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                                            <div class=\"qty-control desktop-only\">\r\n");
      out.write("                                                                <div class=\"qty-wrapper\">\r\n");
      out.write("                                                                    <button type=\"button\" class=\"qty-btn\"\r\n");
      out.write("                                                                        onclick=\"updateQty(");
      out.print( i.getProduct().getId() );
      out.write(", -1, ");
      out.print( i.getQuantity() );
      out.write(")\"\r\n");
      out.write("                                                                        aria-label=\"Giảm\">-</button>\r\n");
      out.write("                                                                    <input type=\"text\" class=\"qty-input\"\r\n");
      out.write("                                                                        value=\"");
      out.print( i.getQuantity() );
      out.write("\" readonly\r\n");
      out.write("                                                                        aria-label=\"Số lượng\">\r\n");
      out.write("                                                                    <button type=\"button\" class=\"qty-btn\"\r\n");
      out.write("                                                                        onclick=\"updateQty(");
      out.print( i.getProduct().getId() );
      out.write(", 1, ");
      out.print( i.getQuantity() );
      out.write(")\"\r\n");
      out.write("                                                                        aria-label=\"Tăng\">+</button>\r\n");
      out.write("                                                                </div>\r\n");
      out.write("                                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                                            <div class=\"item-subtotal desktop-only\">\r\n");
      out.write("                                                                ₫");
      out.print( String.format("%,.0f", i.getTotalPrice()) );
      out.write("\r\n");
      out.write("                                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                                            <div class=\"item-actions desktop-only\">\r\n");
      out.write("                                                                <a href=\"cart?action=delete&id=");
      out.print( i.getProduct().getId() );
      out.write("\"\r\n");
      out.write("                                                                    class=\"btn-text\"\r\n");
      out.write("                                                                    style=\"text-decoration:none;\">Xóa</a>\r\n");
      out.write("                                                                <button class=\"btn-text highlight\"\r\n");
      out.write("                                                                    style=\"font-size:12px;\">Tìm sản phẩm tương tự <i\r\n");
      out.write("                                                                        class=\"fa-solid fa-caret-down\"></i></button>\r\n");
      out.write("                                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                                            <!-- Mobile Delete Icon -->\r\n");
      out.write("                                                            <a href=\"cart?action=delete&id=");
      out.print( i.getProduct().getId() );
      out.write("\"\r\n");
      out.write("                                                                class=\"btn-text mobile-only\"\r\n");
      out.write("                                                                style=\"position:absolute; right:12px; top:12px; color:#888;\"\r\n");
      out.write("                                                                aria-label=\"Xóa\">\r\n");
      out.write("                                                                <i class=\"fa-solid fa-trash\"></i>\r\n");
      out.write("                                                            </a>\r\n");
      out.write("                                                        </div>\r\n");
      out.write("                                                        ");
 } 
      out.write("\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                            </div>\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                    </div>\r\n");
      out.write("\r\n");
      out.write("                                    <!-- Sticky Summary Desktop/Mobile -->\r\n");
      out.write("                                    <div class=\"cart-summary sticky-bottom\" id=\"cartSummary\">\r\n");
      out.write("                                        <div class=\"summary-top\">\r\n");
      out.write("                                            <div class=\"voucher-row\">\r\n");
      out.write("                                                <div class=\"voucher-left\">\r\n");
      out.write("                                                    <i class=\"fa-solid fa-ticket\" style=\"color: var(--primary);\"></i>\r\n");
      out.write("                                                    Shopee Voucher\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <a href=\"search?txt=\" class=\"link-blue\"\r\n");
      out.write("                                                    style=\"text-decoration:none;\">Chọn hoặc nhập\r\n");
      out.write("                                                    mã</a>\r\n");
      out.write("                                            </div>\r\n");
      out.write("                                            <div class=\"coins-row\">\r\n");
      out.write("                                                <div class=\"coins-left\">\r\n");
      out.write("                                                    <i class=\"fa-solid fa-coins\" style=\"color: #f6a700;\"></i> Shopee Xu\r\n");
      out.write("                                                    <span class=\"coin-hint\">Không thể dùng xu</span>\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <div class=\"coins-right\">-0₫</div>\r\n");
      out.write("                                            </div>\r\n");
      out.write("                                        </div>\r\n");
      out.write("\r\n");
      out.write("                                        <div class=\"summary-bottom\">\r\n");
      out.write("                                            <div class=\"summary-actions desktop-only\">\r\n");
      out.write("                                                <label class=\"checkbox-container\">\r\n");
      out.write("                                                    <input type=\"checkbox\" id=\"selectAllBottom\" aria-label=\"Chọn tất cả\"\r\n");
      out.write("                                                        onchange=\"toggleSelectAll(this)\" checked>\r\n");
      out.write("                                                    <span class=\"checkmark\"></span>\r\n");
      out.write("                                                    Chọn Tất Cả (<span id=\"totalSelectedCountText\">\r\n");
      out.write("                                                        ");
      out.print( totalItems );
      out.write("\r\n");
      out.write("                                                    </span>)\r\n");
      out.write("                                                </label>\r\n");
      out.write("                                                <button class=\"btn-text\" id=\"btnDeleteSelected\">Xóa</button>\r\n");
      out.write("                                                <button class=\"btn-text highlight\">Lưu vào mục Đã thích</button>\r\n");
      out.write("                                            </div>\r\n");
      out.write("\r\n");
      out.write("                                            <div class=\"summary-checkout\">\r\n");
      out.write("                                                <label class=\"checkbox-container mobile-only\"\r\n");
      out.write("                                                    style=\"padding-left: 24px;\">\r\n");
      out.write("                                                    <input type=\"checkbox\" id=\"selectAllMobile\" aria-label=\"Chọn tất cả\"\r\n");
      out.write("                                                        onchange=\"toggleSelectAll(this)\" checked>\r\n");
      out.write("                                                    <span class=\"checkmark\"></span>\r\n");
      out.write("                                                    Tất cả\r\n");
      out.write("                                                </label>\r\n");
      out.write("\r\n");
      out.write("                                                <div class=\"total-info\">\r\n");
      out.write("                                                    <div class=\"shipping-info desktop-only\">\r\n");
      out.write("                                                        <i class=\"fa-solid fa-truck-fast\"></i> Giảm 500.000₫ phí vận\r\n");
      out.write("                                                        chuyển đơn tối thiểu 0₫ <a href=\"search?txt=\" class=\"link-blue\"\r\n");
      out.write("                                                            style=\"font-size: 12px;text-decoration:none;\">Tìm hiểu\r\n");
      out.write("                                                            thêm</a>\r\n");
      out.write("                                                    </div>\r\n");
      out.write("                                                    <div class=\"total-price-line\">\r\n");
      out.write("                                                        <span class=\"total-label\">Tổng thanh toán (<span\r\n");
      out.write("                                                                id=\"totalSelectedCount\">\r\n");
      out.write("                                                                ");
      out.print( totalQty );
      out.write("\r\n");
      out.write("                                                            </span> sản phẩm):</span>\r\n");
      out.write("                                                        <span class=\"total-amount\" id=\"totalAmount\">₫");
      out.print(
                                                                String.format("%,.0f", totalMoney));
      out.write("</span>\r\n");
      out.write("                                                    </div>\r\n");
      out.write("                                                </div>\r\n");
      out.write("                                                <form action=\"checkout\" method=\"get\" class=\"d-inline m-0\"\r\n");
      out.write("                                                    style=\"height:100%; display:flex;\">\r\n");
      out.write("                                                    <button type=\"submit\" id=\"btnCheckout\" class=\"btn-checkout\"\r\n");
      out.write("                                                        style=\"height: 100%; border-radius: 0; margin-left: 10px; font-weight:bold; min-height: 50px;\">\r\n");
      out.write("                                                        MUA HÀNG\r\n");
      out.write("                                                    </button>\r\n");
      out.write("                                                </form>\r\n");
      out.write("                                            </div>\r\n");
      out.write("                                        </div>\r\n");
      out.write("                                    </div>\r\n");
      out.write("                                    ");
 } 
      out.write("\r\n");
      out.write("\r\n");
      out.write("                        </div>\r\n");
      out.write("\r\n");
      out.write("                        <!-- Recommended Section -->\r\n");
      out.write("                        <div class=\"container recommended-section\">\r\n");
      out.write("                            <div class=\"recommended-header\">\r\n");
      out.write("                                <h3 style=\"color: var(--text-muted); font-weight: 500; font-size:16px; margin:0;\">CÓ THỂ\r\n");
      out.write("                                    BẠN CŨNG THÍCH</h3>\r\n");
      out.write("                                <a href=\"search?txt=\" class=\"link-orange\" style=\"text-decoration:none;\">Xem Tất Cả <i\r\n");
      out.write("                                        class=\"fa-solid fa-chevron-right\" style=\"font-size: 10px;\"></i></a>\r\n");
      out.write("                            </div>\r\n");
      out.write("                            <div class=\"recommended-grid\" id=\"recommendedGrid\">\r\n");
      out.write("                                <!-- Sẽ chèn gợi ý sản phẩm placeholder từ JS -->\r\n");
      out.write("                            </div>\r\n");
      out.write("                        </div>\r\n");
      out.write("\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <!-- Scripts -->\r\n");
      out.write("                <!-- Không chèn main.js cũ vì nó sẽ render đè mất dữ liệu JSP. Mình giữ nguyên thẻ HTML này -->\r\n");
      out.write("                <script>\r\n");
      out.write("                    // JS API cho Giỏ Hàng\r\n");
      out.write("                    function updateQty(id, change, currentQty) {\r\n");
      out.write("                        const newQty = parseInt(currentQty) + parseInt(change);\r\n");
      out.write("                        if (newQty <= 0 && !confirm(\"Bạn có chắc muốn xóa sản phẩm này khỏi giỏ hàng?\")) {\r\n");
      out.write("                            return;\r\n");
      out.write("                        }\r\n");
      out.write("                        // Gửi request API cập nhật\r\n");
      out.write("                        fetch('cart?action=update&id=' + id + '&qty=' + newQty)\r\n");
      out.write("                            .then(res => {\r\n");
      out.write("                                if (res.ok) window.location.reload();\r\n");
      out.write("                            });\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    // JS Xử lý Checkbox tính tổng tiền tự động\r\n");
      out.write("                    function toggleSelectAll(source) {\r\n");
      out.write("                        const checkboxes = document.querySelectorAll('.item-checkbox');\r\n");
      out.write("                        checkboxes.forEach(cb => cb.checked = source.checked);\r\n");
      out.write("\r\n");
      out.write("                        // Sync các nút selectAll với nhau (top, bottom, mobile)\r\n");
      out.write("                        document.getElementById('selectAllTop').checked = source.checked;\r\n");
      out.write("                        document.getElementById('selectAllBottom').checked = source.checked;\r\n");
      out.write("                        document.getElementById('selectAllMobile').checked = source.checked;\r\n");
      out.write("                        document.querySelector('.shop-checkbox').checked = source.checked;\r\n");
      out.write("\r\n");
      out.write("                        calculateTotal();\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    document.getElementById('selectAllTop').addEventListener('change', function () { toggleSelectAll(this); });\r\n");
      out.write("                    document.querySelector('.shop-checkbox').addEventListener('change', function () { toggleSelectAll(this); });\r\n");
      out.write("\r\n");
      out.write("                    function calculateTotal() {\r\n");
      out.write("                        const checkboxes = document.querySelectorAll('.item-checkbox');\r\n");
      out.write("                        let totalMoney = 0;\r\n");
      out.write("                        let totalQty = 0;\r\n");
      out.write("                        let unselectedAny = false;\r\n");
      out.write("\r\n");
      out.write("                        checkboxes.forEach(cb => {\r\n");
      out.write("                            if (cb.checked) {\r\n");
      out.write("                                const price = parseFloat(cb.getAttribute('data-price') || 0);\r\n");
      out.write("                                const qty = parseInt(cb.getAttribute('data-qty') || 0);\r\n");
      out.write("                                totalMoney += (price * qty);\r\n");
      out.write("                                totalQty += qty;\r\n");
      out.write("                            } else {\r\n");
      out.write("                                unselectedAny = true;\r\n");
      out.write("                            }\r\n");
      out.write("                        });\r\n");
      out.write("\r\n");
      out.write("                        // Cập nhật text tổng số lượng và số tiền\r\n");
      out.write("                        const formatter = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' });\r\n");
      out.write("                        document.getElementById('totalSelectedCountText').innerText = totalQty;\r\n");
      out.write("                        document.getElementById('totalSelectedCount').innerText = totalQty;\r\n");
      out.write("                        document.getElementById('totalAmount').innerText = formatter.format(totalMoney).replace(/\\s/, '').replace(\"₫\", \"₫\").replace(\"VND\", \"₫\");\r\n");
      out.write("\r\n");
      out.write("                        // Cập nhật trạng thái selectAll\r\n");
      out.write("                        const allChecked = !unselectedAny;\r\n");
      out.write("                        document.getElementById('selectAllTop').checked = allChecked;\r\n");
      out.write("                        document.getElementById('selectAllBottom').checked = allChecked;\r\n");
      out.write("                        document.getElementById('selectAllMobile').checked = allChecked;\r\n");
      out.write("                        document.querySelector('.shop-checkbox').checked = allChecked;\r\n");
      out.write("\r\n");
      out.write("                        // Cập nhật nút Mua hàng\r\n");
      out.write("                        const btnCheckout = document.getElementById('btnCheckout');\r\n");
      out.write("                        if (totalQty > 0) {\r\n");
      out.write("                            btnCheckout.removeAttribute('disabled');\r\n");
      out.write("                            btnCheckout.style.opacity = \"1\";\r\n");
      out.write("                            btnCheckout.style.pointerEvents = \"auto\";\r\n");
      out.write("                        } else {\r\n");
      out.write("                            btnCheckout.setAttribute('disabled', 'disabled');\r\n");
      out.write("                            btnCheckout.style.opacity = \"0.6\";\r\n");
      out.write("                            btnCheckout.style.pointerEvents = \"none\";\r\n");
      out.write("                        }\r\n");
      out.write("                    }\r\n");
      out.write("\r\n");
      out.write("                    document.addEventListener('DOMContentLoaded', () => {\r\n");
      out.write("                        const btnOpen = document.getElementById('mobileOpenCartBtn');\r\n");
      out.write("                        const panel = document.getElementById('cartPanel');\r\n");
      out.write("                        const overlay = document.getElementById('cartOverlay');\r\n");
      out.write("                        const btnClose = document.getElementById('closeCartBtn');\r\n");
      out.write("\r\n");
      out.write("                        if (btnOpen) btnOpen.onclick = () => { panel.classList.add('open'); overlay.classList.add('show'); };\r\n");
      out.write("                        if (btnClose) btnClose.onclick = () => { panel.classList.remove('open'); overlay.classList.remove('show'); };\r\n");
      out.write("                        if (overlay) overlay.onclick = () => { panel.classList.remove('open'); overlay.classList.remove('show'); };\r\n");
      out.write("\r\n");
      out.write("                        // Tính tiền lần đầu load\r\n");
      out.write("                        calculateTotal();\r\n");
      out.write("                    });\r\n");
      out.write("                </script>\r\n");
      out.write("            </body>\r\n");
      out.write("\r\n");
      out.write("            </html>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof jakarta.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try {
            if (response.isCommitted()) {
              out.flush();
            } else {
              out.clearBuffer();
            }
          } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
